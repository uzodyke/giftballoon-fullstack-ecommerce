---
export interface Props {
  title: string;
  description: string;
  ogImage?: string;
  canonicalURL?: string;
  schema?: any;
  keywords?: string;
  location?: string;
  service?: string;
}

const {
  title,
  description,
  ogImage = '/images/5. Love bouquet_£30.png',
  canonicalURL = new URL(Astro.url.pathname, Astro.site).toString(),
  schema,
  keywords = 'personalised balloons, custom balloons, balloon bouquet, personalised gifts, balloon delivery UK',
  location,
  service
} = Astro.props;

// Critical CSS for above-the-fold content
const criticalCSS = `
  /* Critical CSS - Above the fold */
  *{margin:0;padding:0;box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{font-family:Poppins,system-ui,sans-serif;line-height:1.6;color:#334155}
  .navbar{background:linear-gradient(135deg,#ff6b9d,#ffa8d8);position:sticky;top:0;z-index:1000;padding:1rem 0}
  .nav-container{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center}
  .nav-logo h1{color:white;font-size:1.8rem;font-weight:600}
  .nav-logo a{color:white;text-decoration:none}
  .hero{background:linear-gradient(135deg,#fff1f8,#ffeef6);padding:80px 0;min-height:70vh;display:flex;align-items:center}
  .hero-content{max-width:1200px;margin:0 auto;padding:0 20px;display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center}
  .cta-button{background:linear-gradient(135deg,#ff6b9d,#ff8fab);color:white;padding:15px 30px;border:none;border-radius:50px;font-size:1.1rem;font-weight:600;cursor:pointer;text-decoration:none;display:inline-block;transition:all 0.3s ease}
  @media (max-width:768px){.hero-content{grid-template-columns:1fr;text-align:center}}
`;
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <!-- Essential Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content={Astro.generator} />

  <!-- SEO Meta Tags -->
  <title>{title}</title>
  <meta name="description" content={description}>
  <meta name="keywords" content={keywords}>
  <link rel="canonical" href={canonicalURL}>

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={new URL(ogImage, Astro.site).toString()}>
  <meta property="og:site_name" content="Gifted Balloon">
  <meta property="og:locale" content="en_GB">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content={canonicalURL}>
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={new URL(ogImage, Astro.site).toString()}>

  <!-- Additional SEO Meta -->
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <meta name="author" content="Gifted Balloon">
  <meta name="theme-color" content="#ff6b9d">
  <meta name="msapplication-TileColor" content="#ff6b9d">

  <!-- Business Information -->
  <meta name="geo.region" content="GB">
  <meta name="geo.placename" content="United Kingdom">
  <meta name="business.hours" content="Mo-Su 09:00-20:00">

  <!-- Preconnect for Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">

  <!-- Critical CSS Inline -->
  <style set:html={criticalCSS}></style>

  <!-- Zoom Functionality - Immediate Loading -->
  <script is:inline>
    console.log('Loading immediate zoom functionality...');

    // Simple zoom function - available immediately
    function openZoomModal(button) {
      console.log('Zoom triggered for:', button.dataset.productName);

      try {
        // Get modal (create if it doesn't exist)
        let modal = document.getElementById('simple-zoom-modal');
        if (!modal) {
          console.log('Modal not found, will try again when DOM loads');
          return;
        }

        // Update modal content
        const nameEl = document.getElementById('zoom-product-name');
        const descEl = document.getElementById('zoom-product-description');
        const priceEl = document.getElementById('zoom-product-price');
        const imageEl = document.getElementById('zoom-image');

        if (nameEl) nameEl.textContent = button.dataset.productName || '';
        if (descEl) descEl.textContent = button.dataset.productDescription || '';
        if (priceEl) priceEl.textContent = button.dataset.productPrice || '';
        if (imageEl) {
          imageEl.src = button.dataset.productImage || '';
          imageEl.alt = button.dataset.productName || '';
        }

        // Show modal
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';

        console.log('Zoom modal opened successfully');
      } catch (error) {
        console.error('Zoom error:', error);
      }
    }

    // Close modal function
    function closeZoomModal() {
      const modal = document.getElementById('simple-zoom-modal');
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
      }
    }

    // Set up event delegation immediately
    document.addEventListener('click', function(e) {
      // Handle zoom triggers
      if (e.target.classList.contains('zoom-trigger') || e.target.classList.contains('quick-view-btn')) {
        e.preventDefault();
        openZoomModal(e.target);
        return;
      }

      // Handle close buttons
      if (e.target.id === 'close-zoom' ||
          e.target.closest('#close-zoom') ||
          (e.target.id === 'simple-zoom-modal' && e.target === e.currentTarget)) {
        closeZoomModal();
        return;
      }
    });

    // Make functions globally available for any remaining inline handlers
    window.openImageZoom = openZoomModal;
    window.openZoomModal = openZoomModal;
    window.closeZoomModal = closeZoomModal;

    console.log('Zoom functionality loaded and ready');
  </script>

  <!-- Font Loading Strategy -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </noscript>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  <!-- Schema.org Structured Data -->
  {schema && (
    <script type="application/ld+json" set:html={JSON.stringify(schema)}></script>
  )}

  <!-- Default Business Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Gifted Balloon",
    "description": "Personalised balloon bouquets and custom balloon gifts for all occasions across the UK",
    "url": "https://giftedballoon.com",
    "logo": "https://giftedballoon.com/logo.png",
    "image": "https://giftedballoon.com/images/5. Love bouquet_£30.png",
    "telephone": "+447459665002",
    "email": "info@giftedballoon.com",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "GB"
    },
    "serviceArea": {
      "@type": "Country",
      "name": "United Kingdom"
    },
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "Personalised Balloon Services",
      "itemListElement": [
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "Personalised Balloon Bouquets",
            "description": "Custom balloon arrangements for any occasion"
          }
        }
      ]
    },
    "sameAs": [
      "https://www.facebook.com/giftedballoon",
      "https://www.instagram.com/giftedballoon",
      "https://www.twitter.com/giftedballoon"
    ],
    "openingHours": "Mo-Su 09:00-20:00",
    "priceRange": "£25-£45"
  }
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=GA_TRACKING_ID"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'GA_TRACKING_ID', {
      page_title: document.title,
      page_location: window.location.href,
      custom_map: {
        'custom_location': location || 'general',
        'custom_service': service || 'general'
      }
    });

    // Track phone number clicks
    document.addEventListener('DOMContentLoaded', function() {
      const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
      phoneLinks.forEach(link => {
        link.addEventListener('click', function() {
          gtag('event', 'phone_call', {
            'event_category': 'engagement',
            'event_label': 'phone_number_click'
          });
        });
      });
    });
  </script>
</head>

<body class="bg-gray-50 text-gray-900 antialiased">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary-500 text-white px-4 py-2 rounded">
    Skip to main content
  </a>

  <!-- Navigation -->
  <nav class="navbar bg-gradient-to-r from-primary-400 to-primary-300 sticky top-0 z-50 shadow-lg" role="navigation" aria-label="Main navigation">
    <div class="nav-container max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <div class="nav-logo flex-shrink-0">
          <h1 class="text-white text-xl font-bold">
            <a href="/" class="text-white hover:text-pink-100 transition-colors" aria-label="Gifted Balloon Home">
              🎈 Gifted Balloon
            </a>
          </h1>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:block">
          <div class="ml-10 flex items-baseline space-x-4">
            <a href="/" class="text-white hover:text-pink-100 px-3 py-2 rounded-md text-sm font-medium transition-colors">
              Home
            </a>
            <a href="/shop" class="text-white hover:text-pink-100 px-3 py-2 rounded-md text-sm font-medium transition-colors">
              Shop
            </a>
            <a href="/services/weddings" class="text-white hover:text-pink-100 px-3 py-2 rounded-md text-sm font-medium transition-colors">
              Services
            </a>
            <a href="/locations/london" class="text-white hover:text-pink-100 px-3 py-2 rounded-md text-sm font-medium transition-colors">
              Locations
            </a>
            <a href="/about" class="text-white hover:text-pink-100 px-3 py-2 rounded-md text-sm font-medium transition-colors">
              About
            </a>
            <a href="/contact" class="text-white hover:text-pink-100 px-3 py-2 rounded-md text-sm font-medium transition-colors">
              Contact
            </a>
          </div>
        </div>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button
            type="button"
            class="mobile-menu-button text-white hover:text-pink-100 inline-flex items-center justify-center p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-white"
            aria-controls="mobile-menu"
            aria-expanded="false"
            aria-label="Toggle navigation menu"
          >
            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div class="mobile-menu hidden md:hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-primary-500 rounded-lg mt-2">
          <a href="/" class="text-white hover:text-pink-100 block px-3 py-2 rounded-md text-base font-medium">Home</a>
          <a href="/shop" class="text-white hover:text-pink-100 block px-3 py-2 rounded-md text-base font-medium">Shop</a>
          <a href="/services/weddings" class="text-white hover:text-pink-100 block px-3 py-2 rounded-md text-base font-medium">Services</a>
          <a href="/locations/london" class="text-white hover:text-pink-100 block px-3 py-2 rounded-md text-base font-medium">Locations</a>
          <a href="/about" class="text-white hover:text-pink-100 block px-3 py-2 rounded-md text-base font-medium">About</a>
          <a href="/contact" class="text-white hover:text-pink-100 block px-3 py-2 rounded-md text-base font-medium">Contact</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main id="main-content" role="main">
    <slot />
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white" role="contentinfo">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <!-- Company Info -->
        <div class="space-y-4">
          <h3 class="text-xl font-bold text-primary-300">Gifted Balloon</h3>
          <p class="text-gray-300">Creating personalised balloon memories across the UK</p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-primary-300 transition-colors" aria-label="Facebook">
              <span class="sr-only">Facebook</span>
              📘
            </a>
            <a href="#" class="text-gray-400 hover:text-primary-300 transition-colors" aria-label="Instagram">
              <span class="sr-only">Instagram</span>
              📷
            </a>
            <a href="#" class="text-gray-400 hover:text-primary-300 transition-colors" aria-label="Twitter">
              <span class="sr-only">Twitter</span>
              🐦
            </a>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="space-y-4">
          <h4 class="text-lg font-semibold text-primary-300">Quick Links</h4>
          <ul class="space-y-2">
            <li><a href="/" class="text-gray-300 hover:text-white transition-colors">Home</a></li>
            <li><a href="/shop" class="text-gray-300 hover:text-white transition-colors">Shop</a></li>
            <li><a href="/about" class="text-gray-300 hover:text-white transition-colors">About</a></li>
            <li><a href="/faq" class="text-gray-300 hover:text-white transition-colors">FAQ</a></li>
          </ul>
        </div>

        <!-- Services -->
        <div class="space-y-4">
          <h4 class="text-lg font-semibold text-primary-300">Services</h4>
          <ul class="space-y-2">
            <li><a href="/services/weddings" class="text-gray-300 hover:text-white transition-colors">Wedding Balloons</a></li>
            <li><a href="/services/corporate-events" class="text-gray-300 hover:text-white transition-colors">Corporate Events</a></li>
            <li><a href="/services/birthdays" class="text-gray-300 hover:text-white transition-colors">Birthday Balloons</a></li>
            <li><a href="/services/graduations" class="text-gray-300 hover:text-white transition-colors">Graduations</a></li>
          </ul>
        </div>

        <!-- Contact Info -->
        <div class="space-y-4">
          <h4 class="text-lg font-semibold text-primary-300">Contact Info</h4>
          <div class="space-y-2 text-gray-300">
            <p>📧 <a href="mailto:info@giftedballoon.com" class="hover:text-white transition-colors">info@giftedballoon.com</a></p>
            <p>📞 <a href="tel:+447459665002" class="hover:text-white transition-colors">+44 7459 665002</a></p>
            <p>🕒 Mon-Sun: 9AM-8PM</p>
            <p>📍 Nationwide UK Delivery</p>
          </div>
        </div>
      </div>

      <!-- Bottom Bar -->
      <div class="border-t border-gray-700 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-400">&copy; 2024 Gifted Balloon. All rights reserved.</p>
        <div class="flex space-x-4 mt-4 md:mt-0">
          <a href="/privacy-policy" class="text-gray-400 hover:text-white transition-colors">Privacy Policy</a>
          <a href="/terms-and-conditions" class="text-gray-400 hover:text-white transition-colors">Terms & Conditions</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Mobile Menu Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuButton = document.querySelector('.mobile-menu-button');
      const mobileMenu = document.querySelector('.mobile-menu');

      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
          const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
          mobileMenuButton.setAttribute('aria-expanded', !expanded);
        });
      }
    });
  </script>

  <!-- Deferred JavaScript -->
  <script defer>
    // Lazy load non-critical images
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imageObserver.unobserve(img);
          }
        });
      });

      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }
  </script>
</body>
</html>